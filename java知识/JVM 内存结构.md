##### `JVM` 内存结构

##### `JMM` 内存模型

![](https://note-austen-1256667106.cos.ap-beijing.myqcloud.com/image-20200616181349436.png)



##### 什么是内存模型

内存模型是一套共享内存系统中多线程读写操作行为的规范，这套规范屏蔽了底层各种硬件和操作系统的内存访问差异，解决了 CPU 多级缓存、CPU 优化、指令重排等导致的内存访问问题，从而保证 Java 程序（尤其是多线程程序）在各种平台下对内存的访问效果一致。

在 Java 内存模型中，我们统一用工作内存（working memory）来当作 CPU 中寄存器或高速缓存的抽象。线程之间的共享变量存储在主内存（main memory）中，每个线程都有一个私有工作内存（类比 CPU 中的寄存器或者高速缓存），本地工作内存中存储了该线程读/写共享变量的副本。

##### happens-before 先行先发生原则

happens-before 用于描述两个操作的内存可见性，可通过保证可见性的机制可以让应用程序免于数据竞争干扰。

如果一个操作 A happens-before 另一个操作 B ，那么操作 A 的执行结果对操作 B 可见。

**JMM 中定义类一下几种情况自动符合 happens-before 规则：**

1. 程序次序规则
2. 锁定规则
3. 变量规则
4. 线程启动规则
5. 线程中断规则
6. 线程终结规则
7. 对象终结规则

##### 总结：

* Java 内存模式的来源：隔离在不同硬件，让 Java 程序尤其是在多线程环境访问内存的效果的一致的。
* Java 内存模式是什么：本质上它是一套规范，共享内存系统中多线程读写操作行为的一套规范。在这个规范中最重要的是 happens-before 原则。
* `Voliate`