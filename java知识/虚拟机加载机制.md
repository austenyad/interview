# 虚拟机加载机制

## 加载

## 验证

## 准备

## 解析

## 初始化阶段

#### \<clinit>()

* 方法是由编译器自动收集类中所有变量的 **赋值动作** 和 **静态语句块中的语句合并产生的**，编译器收集的顺序有语句在源文件中出现的顺序所决定，静态语句块中只能访问到定义在静态语句块之前的变量，定义在它之后的变量，在前面的静态语句块中可以赋值，但是不能访问。

```java
public class Test{
	static{
		i = 0; // 给变量赋值可以正常编译通过
		System.out.println(i); // 这句编译提示 ”非法向前引用“
	}
	static int i = 1;
}
```

* 接口中不能使用静态代码块，但仍然可以有变量初始化的赋值操作，因此接口与类一样都生成\<clinit>() 方法。但接口与类不同的是，执行接口的 \<clinit>() 方法不需要执行父类接口的\<clinit>()方法。只有当父类接口中有变量使用时，父接口才会初始化。另外，接口的实现类初始化时也一样不会执行接口的 \<clinit>() 方法。
* \<clinit>() 方法对于类或接口来说不是必须的，如果一个类中没有一个静态语句块，也没有对变量的赋值操作，那么编译器可以不为这个类生成 \<clinit>() 方法。
* 虚拟机保证一个类的 \<clinit>() 方法在多线程环境中被正确的加锁、同步，如果多个线程同时去初始化一个类，那么只会有一个线程去执行这个类的 \<clinit>() 方法，其他线程都需要阻塞等待，直到活动的线程执行  \<clinit>() 方法完毕。如果一个类的 \<clinit>() 方法中有耗时操作，就可能造成多个线程阻塞，