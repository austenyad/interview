# 一 性能优化有哪些那题

### 1. 性能表现差

 App 的性能自身表现差，这是从 App 自身性能的视角来说的。

1. 有些问题用户是可以直观的感受到的，比如 App 启动慢、卡顿、丢帧等。

2. 另外一种虽然说用户无法直接的感受到 ，比如：内存占用高、内存抖动频繁。这种隐藏的问题就可能在一些版本或硬件较低的手机上，出现内存溢出影响程序的正常运行。

3. 此外还有：应用耗电，网络请求慢等。

4. 崩溃率、异常率高等（属于应用稳定性的范畴）

### 2. 线程问题无从追查

1. **当线上出现了异常如何才能保证 较高的异常感知灵敏度，**当我上发布了一个新版本，上线的新版本，没有用户反馈，我们也千万不能，已经成功上线了，因为仅仅依赖于 用户反馈 这一单一的渠道，非常容易错过异常出现的第一时间，等到有用户不可忍受来反馈的时候造成的损失已经太大，而且呢已经错过了最好的处理时机。
2. 如何复用 案发 现场。假设用户给我们反馈，但是此时我们也不能高兴的过早，因为此时用户有反馈并不代表我们就可以复现，很多问题并不是所用用户都会发生，发生了这种特殊问题的用户，可能是使用了特殊的设备，或者是他的账号处于特定的异常状态，等到我们在公司用自己的设备自己的账号检查问题的时候很有可能条件不足，无法复现，自然也就么有办法快速解决。
3. 如何快速 止血 成功。 针对线上问题，时间就是生命，必须尽早的成果修复，而当我们修复之后 ，为了保险起见，会开部分小流量用户，或是找特定用户来进行一下测试，但是如果说我们的手段是：联系用户，重新安装、然后等待结果，这样的解决方案它的周期实在是太长，而且多次下来用户也会不胜其烦，最终你可能找不到配合你的用户

### 3. 性能优化的长期开销大

1. 如果扼杀问题于萌芽：如果说我们在每个版本来跟踪大量与性能优化相关的问题，长期来看团队的资源消耗非常大，团队的产出也就变少，于是我们就得思考如何将问题扼杀在萌芽之中，尽可能的在上线之前将问题解决掉。
2. 性能优化的效果不能长期保持，我们优化完之后的程序，如果没有措施，在接下来的版本当中，会再次遭到破坏，出现性能问题还是需要我们优化。设想一下，这样长期的重复，会导致开销变大 。

总结：

性能优化的要求：

* 性能表现好
* 线上问题易追查
* 长期投入小

# 二、性能优化解决方案演进

* 项目初期
* 项目壮大期 
* 项目成熟期
* 为什么需要自建 AMP

性能优化手段的发展历程?



项目初期：我们的重心一般都放在快速占领市场，尽可能的垒功能，获取用户，这个时候我在对项目做的都是加法，对于性能问题并没有投入关注度，同时在这个阶段我们也没有资源去投入关注度。

1. 这个时候，只关注崩溃率，也不采集其他的性能指标。

2. 同时也没有与性能匹配的检测方案，优化方案等。
3. 针对线上用户的反馈，我们最多也只能够简单优化，直接上线。并没有对单点问题有追查能力。

在项目的初期，可以认为性能优化解决方案处在以三无的状态：

伴随着项目壮大期：性能优化得到了一定的重视，一般都会在这个阶段，逐步的完善应用关于性能的解决方案。：

1. 各项性能指标的采集
2. 接入一套成熟的 APM，来弥补项目在性能检控方面的缺失。但是通用的 AMP 和我们应用自身的情况结合并不紧密。所以说排查问题的手段单一。

3. 针对线下的检测优化方案，可能会逐渐的实现，但是方案并不成型，也不具备可迁移性 

初步拥有了性能问题的定位能力，但是很不完善。

项目成熟期：

1. 重点关注性能问题，对性能问题的数据采集要深入的多，手段也会很多样化，

**2.在线上、和线下都会有一套完善的解决方案（重点）**  2.1二者之间使用场景是有误差的**，所以我们不能只做线下，而不重视线上。2.2线上和线下的侧重点并不一样，针对线下来说侧重点在于预防，是将问题尽可能的扼杀在萌芽当中，不要带到线上去，而对于线上问题的解决方案，主要是在于监控 ，上线之后，完善的监控可以给我们带来 较高的异常感知灵敏度，而且出现问题之后也可以很好的保留我们的现场。所以说二者之间的侧重点其实不一样， 2.3线上和线下，实现的方案不同 针对线下的解决方案我们可以大胆的时候各自 hook 、黑科技，以便帮助我们可以全面的获取信息。但是许多黑科技的方案 ，因为一些原因它可能没有办法带到线上去，所以说二者在实现上也是有些差别的

3. 自建 APM ，如说用户还孵化的新产品就可以快速的接入。

拥有了完善的性能指标，和排查手段，同时可移植性也非常强。



为什么项目壮大之后会选择自建 APM ?

1.**对于 外部 APM 成熟通用，但不满足个性化要就。**比如说：我们对 APP 启动监控要细化几个阶段，而不是最终看一个指标，哪这种个性化的需求外部 AMP 肯定是没有办法满足的。引用你可能要两个阶段，别的公司想要三个阶段，它是没有办法帮你满足这个个性化需求的。

**2.外部 APM 和 内部系统很难打通，带来时间成本**：比如说，我们在外部 APM 发现一个奔溃，但是我们发现这个奔溃之后并没有 直接解决问题。我们希望能够看一个这个用户的浏览途径，我们想做用户的行为日志，看他经过了那些步骤，才能导致奔溃，而我们在线下却没有办法复现，但是这种 APM 它并没有用户的行为数据，这个行为数据它是在我们的内部系统的，这样来说这两个系统就是有一定的系统偏差，我们没有办法很快速的解决问题，

**3数据必须保证在自己手中**，当我们的项目到达了几百万，乃至上千万的用户，其实很容易被竞争对手盯上，如果说我们使用了外部的 APM 平台，我的日活，日均使用时长，还有一些核心的运营数据，都可能很容易的暴露给我们的竞争对象



总结：项目优化手段在不同阶段的状态 ，以及发展过程，同时知道在项目壮大之后都会自建 APM 的原因。



# 三、业界优秀的平台化实践 

* Crash 收集平台
* APM 平台
* 自建解决方案

1.  Bugly :

优点：数据采集和上报成功率高，同时包含 Java 和 native 奔溃，建议：由于 native 的奔溃的抓取和还原相复杂，所以说更加建议大家在项目初期，直接接入 bugly，减少研发成本。

2. 听云 商业级 APM 平台

优点：一套通用的性能解决方案，数据采集非常完善 ，接入也很方便

缺点：无法满足项目成熟之后一些个性化定制需求，而且我的数据保存在第三方平台 ，有一定的隐患。

建议：在我们项目 性能优化方案不完善的时候接入，在项目成熟之后自建 APM 

3. 自建 APM 平台：

美团、协程、360

优点：贴合自身业务特点，快速满足定制化需求，数据安全 





立足于项目的整个周期，展示自己具备全局性的视野，

讲案例要：找普遍性的痛点

超预期：体系你和被人的区别 总结能力、深度思考能力 

* 你们为什么要做性能优化？
  1. 体验查影响核心指标，体验不好 ，举例：上线一个功能，并没有达到我们的预期，最发现是因为我们打开界面的时候有些卡顿，于是在接下来的版本中我们对卡顿问题进行了修复
  2. 线上问题排查比较困难。
  3. 怎样降低性能优化的长期开销。平台化于工具化
* 介绍性能优化平台吗？

1. 交代背景
2. 具体讲解 初始 中期 后期 接入商业 APM  成熟期时候自建 APM 实现了各种定制化数据的采集



* 为什要自建 APM ?

1. 需求层面，商业APM 不满足我们个性化需求的目的 Aplication 耗费的时间 Activity 耗费的时间，我们想知道它在每个阶段的时间 ，对于商业 APM 它就没有办法满足
2. 效率层面 商业 APM 和我们内部的系统结合的非常不好，比如说我们在商业 APM 中发现一些性能问题，我们往往需要跑到我们自己的内部系统我们来查找是那个用户，我们来看它的行为日志，这样的话结合的并不紧密，导致这个时间上的浪费查找问题效率也非常的低下，
3. 核心运营数据。安全性。

4. 快速接入公司别的项目中，虽然在 自建 APM 的过程中我们花费了一些资源，但是从长期来看我们是节约了资源的



 



 













